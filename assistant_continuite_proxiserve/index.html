<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant Continuité - Aurélien DA COSTA</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232563eb' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z'/%3E%3Cpath d='m9 12 2 2 4-4'/%3E%3C/svg%3E">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'media', 
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af', 
                            900: '#1e3a8a',
                            950: '#172554',
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gmail-preview {
            font-family: Verdana, sans-serif;
            font-size: 13px;
            color: #222;
            line-height: 1.5;
        }
        
        @media (prefers-color-scheme: dark) {
            ::-webkit-scrollbar { width: 8px; }
            ::-webkit-scrollbar-track { background: #1e293b; }
            ::-webkit-scrollbar-thumb { background: #475569; rounded: 4px; }
            ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 min-h-screen transition-colors duration-300">

    <!-- Navbar -->
    <nav class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-brand-600 text-white p-1.5 rounded-lg shadow-sm">
                        <i data-lucide="shield-check" class="w-6 h-6"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-bold text-lg tracking-tight text-slate-900 dark:text-white leading-tight">
                            Assistant de Continuité
                        </span>
                        <span class="text-[10px] uppercase tracking-wider text-slate-500 dark:text-slate-400 font-semibold">
                            Proxiserve | Direction Technique
                        </span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right hidden sm:block">
                        <p class="text-sm font-medium text-slate-900 dark:text-white">Aurélien DA COSTA</p>
                        <p class="text-xs text-slate-500 dark:text-slate-400">Chef de Projets</p>
                    </div>
                    <div class="h-8 w-8 rounded-full bg-brand-100 dark:bg-brand-900 flex items-center justify-center text-brand-700 dark:text-brand-300 font-bold text-xs border border-brand-200 dark:border-brand-700">
                        AD
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Panel: Controls -->
            <section class="lg:col-span-4 space-y-6">
                
                <!-- Contexte -->
                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
                    <div class="px-5 py-4 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/50">
                        <h2 class="text-sm font-semibold text-slate-900 dark:text-white uppercase tracking-wide flex items-center gap-2">
                            <i data-lucide="sliders" class="w-4 h-4 text-brand-600 dark:text-brand-400"></i>
                            Contexte
                        </h2>
                    </div>
                    
                    <div class="p-5 space-y-4">
                        <div class="grid gap-3">
                            <!-- RTT Button (New) -->
                            <button onclick="setScenario('rtt')" id="btn-rtt" class="scenario-btn group relative flex items-start gap-3 p-3 rounded-lg border text-left transition-all duration-200 hover:shadow-md">
                                <div class="p-2 rounded-md bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400">
                                    <i data-lucide="coffee" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-slate-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400">RTT / Repos</div>
                                    <div class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">Absence courte (Backup standard)</div>
                                </div>
                                <div class="absolute inset-0 border-2 border-transparent rounded-lg pointer-events-none group-hover:border-purple-100 dark:group-hover:border-slate-600 transition-colors"></div>
                            </button>

                            <button onclick="setScenario('conges')" id="btn-conges" class="scenario-btn group relative flex items-start gap-3 p-3 rounded-lg border text-left transition-all duration-200 hover:shadow-md">
                                <div class="p-2 rounded-md bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400">
                                    <i data-lucide="palmtree" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-slate-900 dark:text-white group-hover:text-brand-600 dark:group-hover:text-brand-400">Congés / Vacances</div>
                                    <div class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">Backup standard (C. DOS SANTOS)</div>
                                </div>
                                <div class="absolute inset-0 border-2 border-transparent rounded-lg pointer-events-none group-hover:border-brand-100 dark:group-hover:border-slate-600 transition-colors"></div>
                            </button>

                            <button onclick="setScenario('deplacement')" id="btn-deplacement" class="scenario-btn group relative flex items-start gap-3 p-3 rounded-lg border text-left transition-all duration-200 hover:shadow-md">
                                <div class="p-2 rounded-md bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400">
                                    <i data-lucide="briefcase" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-slate-900 dark:text-white group-hover:text-brand-600 dark:group-hover:text-brand-400">Déplacement Pro</div>
                                    <div class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">Dispo partielle + Mobile</div>
                                </div>
                                <div class="absolute inset-0 border-2 border-transparent rounded-lg pointer-events-none group-hover:border-brand-100 dark:group-hover:border-slate-600 transition-colors"></div>
                            </button>

                            <button onclick="setScenario('support_off')" id="btn-support_off" class="scenario-btn group relative flex items-start gap-3 p-3 rounded-lg border text-left transition-all duration-200 hover:shadow-md">
                                <div class="p-2 rounded-md bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400">
                                    <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-slate-900 dark:text-white group-hover:text-red-600 dark:group-hover:text-red-400">Support Restreint</div>
                                    <div class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">Mode dégradé (SMS Urgences)</div>
                                </div>
                                <div class="absolute inset-0 border-2 border-transparent rounded-lg pointer-events-none group-hover:border-red-100 dark:group-hover:border-red-900/40 transition-colors"></div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dates & Alert Banner -->
                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden">
                    <div class="px-5 py-4 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/50">
                        <h2 class="text-sm font-semibold text-slate-900 dark:text-white uppercase tracking-wide flex items-center gap-2">
                            <i data-lucide="calendar-clock" class="w-4 h-4 text-brand-600 dark:text-brand-400"></i>
                            Période
                        </h2>
                    </div>
                    <div class="p-5 space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2">
                                <label class="block text-xs font-medium text-slate-500 dark:text-slate-400 uppercase mb-1.5">1er Jour d'absence</label>
                                <input type="date" id="date-start" class="w-full bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-brand-500 focus:border-brand-500 block p-2.5" onchange="updatePreview()">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-xs font-medium text-slate-500 dark:text-slate-400 uppercase mb-1.5">Dernier Jour d'absence</label>
                                <input type="date" id="date-end" class="w-full bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-brand-500 focus:border-brand-500 block p-2.5" onchange="suggestReturnDate()">
                            </div>
                            <div class="col-span-2 pt-2 border-t border-slate-100 dark:border-slate-700 mt-2">
                                <label class="block text-xs font-bold text-brand-600 dark:text-brand-400 uppercase mb-1.5">Date de retour (au bureau)</label>
                                <input type="date" id="date-return" class="w-full bg-blue-50 dark:bg-brand-900/20 border border-brand-200 dark:border-brand-700/50 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-brand-500 focus:border-brand-500 block p-2.5 font-semibold" onchange="updatePreview()">
                            </div>
                        </div>

                        <!-- BANDEAU JAUNE PARAMÉTRAGE GMAIL -->
                        <div class="mt-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 dark:border-yellow-500 p-4 rounded-r-md">
                            <div class="flex gap-3">
                                <i data-lucide="settings" class="w-5 h-5 text-yellow-600 dark:text-yellow-500 shrink-0 mt-0.5"></i>
                                <div>
                                    <h3 class="text-xs font-bold text-yellow-800 dark:text-yellow-400 uppercase mb-1">
                                        Paramétrage Gmail
                                    </h3>
                                    <p class="text-xs text-yellow-700 dark:text-yellow-300 leading-snug">
                                        Activez la réponse automatique :<br>
                                        Du <strong><span id="gmail-start">...</span></strong> au <strong><span id="gmail-end">...</span></strong> inclus.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Panel: Preview & Actions -->
            <section class="lg:col-span-8 flex flex-col h-full">
                
                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 flex flex-col h-full overflow-hidden">
                    
                    <!-- Header -->
                    <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 flex items-center justify-between">
                        <div class="flex items-center gap-2 text-slate-700 dark:text-slate-200">
                            <i data-lucide="eye" class="w-5 h-5"></i>
                            <span class="font-semibold text-sm">Aperçu & Copie</span>
                        </div>
                    </div>

                    <!-- Email Container -->
                    <div class="flex-grow bg-slate-100 dark:bg-slate-900/50 p-4 sm:p-8 overflow-y-auto">
                        
                        <!-- Paper Effect -->
                        <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
                            
                            <!-- Section Objet -->
                            <div class="border-b border-slate-100 p-4 bg-slate-50/50 flex items-center justify-between gap-4">
                                <div class="flex-grow">
                                    <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide mb-1">Objet</div>
                                    <div id="preview-subject" class="text-sm font-medium text-slate-800 select-all font-sans">
                                        [INFO] Message d'Absence
                                    </div>
                                </div>
                                <button onclick="copySubject()" class="shrink-0 bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 px-3 py-1.5 rounded text-xs font-medium flex items-center gap-2 transition-colors">
                                    <i data-lucide="copy" class="w-3 h-3"></i> Copier Objet
                                </button>
                            </div>

                            <!-- Section Corps -->
                            <div class="p-6 sm:p-8 relative">
                                <div id="preview-body" class="gmail-preview">
                                    <!-- Content injected by JS -->
                                </div>
                            </div>
                            
                            <!-- Action Footer -->
                            <div class="bg-slate-50 px-6 py-4 border-t border-slate-100 flex justify-between items-center">
                                <div class="text-[10px] text-slate-400 italic">
                                    Fond blanc et police Verdana forcés.
                                </div>
                                <button onclick="copyBody()" class="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2 rounded-lg flex items-center gap-2 transition-all active:scale-95 font-medium shadow-sm text-sm">
                                    <i data-lucide="copy" class="w-4 h-4"></i>
                                    <span>Copier le corps du message</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-5 py-3 rounded-lg shadow-2xl transform translate-y-24 opacity-0 transition-all duration-300 flex items-center gap-3 z-50 border border-slate-700 dark:border-slate-200">
        <div class="bg-green-500 rounded-full p-1">
            <i data-lucide="check" class="w-3 h-3 text-white"></i>
        </div>
        <div class="flex flex-col">
            <span class="font-bold text-sm" id="toast-msg">Copié avec succès</span>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // Data
        const contactChris = "Christopher DOS SANTOS (cdossantos@proxiserve.fr)"; 
        const signature = `<br><br><b>Aurélien DA COSTA</b><br>Chef de Projets | Direction Technique<br><i>Project Manager | Technical Department</i><br>Groupe Proxiserve - Prox-Hydro`;
        // Modification ici : Utilisation de tirets textuels au lieu de CSS pour supporter le copier-coller sans mise en forme
        const textSeparator = `<br><br>--------------------------------------------------<br><br>`;

        // State & Dates
        let currentScenario = 'rtt'; 
        const today = new Date();
        const tomorrow = new Date(today); tomorrow.setDate(tomorrow.getDate() + 1);
        const dayAfter = new Date(tomorrow); dayAfter.setDate(dayAfter.getDate() + 1);

        document.getElementById('date-start').valueAsDate = today;
        document.getElementById('date-end').valueAsDate = tomorrow;
        document.getElementById('date-return').valueAsDate = dayAfter;

        // Functions
        function setScenario(scenario) {
            currentScenario = scenario;
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('border-brand-500', 'bg-brand-50', 'ring-1', 'ring-brand-500', 'dark:bg-brand-900/20', 'dark:border-brand-500', 
                                     'border-red-500', 'bg-red-50', 'ring-red-500', 'dark:bg-red-900/10', 'dark:border-red-500',
                                     'border-purple-500', 'bg-purple-50', 'ring-purple-500', 'dark:bg-purple-900/10', 'dark:border-purple-500');
                btn.classList.add('border-slate-200', 'dark:border-slate-700');
            });

            const activeBtn = document.getElementById(`btn-${scenario}`);
            activeBtn.classList.remove('border-slate-200', 'dark:border-slate-700');
            
            if (scenario === 'support_off') {
                activeBtn.classList.add('border-red-500', 'bg-red-50', 'ring-1', 'ring-red-500', 'dark:bg-red-900/10', 'dark:border-red-500');
            } else if (scenario === 'rtt') {
                activeBtn.classList.add('border-purple-500', 'bg-purple-50', 'ring-1', 'ring-purple-500', 'dark:bg-purple-900/10', 'dark:border-purple-500');
            } else {
                activeBtn.classList.add('border-brand-500', 'bg-brand-50', 'ring-1', 'ring-brand-500', 'dark:bg-brand-900/20', 'dark:border-brand-500');
            }
            updatePreview();
        }

        function formatDateFR(d) { return d ? new Date(d).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long' }) : "..."; }
        function formatDateEN(d) { return d ? new Date(d).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' }) : "..."; }
        function formatDateShort(d) { return d ? new Date(d).toLocaleDateString('fr-FR') : "..."; }

        function suggestReturnDate() {
            const val = document.getElementById('date-end').value;
            if(val) {
                const d = new Date(val); d.setDate(d.getDate() + 1);
                if(d.getDay() === 6) d.setDate(d.getDate() + 2);
                if(d.getDay() === 0) d.setDate(d.getDate() + 1);
                document.getElementById('date-return').valueAsDate = d;
            }
            updatePreview();
        }

        function updatePreview() {
            const dateStart = document.getElementById('date-start').value;
            const dateEnd = document.getElementById('date-end').value;
            const dateReturn = document.getElementById('date-return').value;
            
            // Mise à jour du bandeau jaune
            document.getElementById('gmail-start').textContent = formatDateShort(dateStart);
            document.getElementById('gmail-end').textContent = formatDateShort(dateEnd);

            const fr = formatDateFR(dateReturn);
            const short = formatDateShort(dateReturn);
            const en = formatDateEN(dateReturn);
            
            let subject = "", body = "";

            if (currentScenario === 'conges') {
                subject = `[INFO] Message d'Absence / Out of Office (Retour : ${short})`;
                body = `Bonjour,<br><br>` +
                       `Je suis actuellement en congés et n'ai pas accès à ma messagerie.<br>` +
                       `Je prendrai connaissance de votre message à mon retour, prévu le <b>${fr}</b>.<br><br>` +
                       `Pour tout incident technique, le réflexe reste d'ouvrir un ticket sur le portail <b>Freshservice</b>.<br><br>` +
                       `En cas d'urgence nécessitant une action immédiate sur l'un de nos systèmes ou sur un flux critique, je vous prie de contacter <b>${contactChris}</b>.<br><br>` +
                       `Cordialement,<br>` +
                       `${textSeparator}` +
                       `Hello,<br><br>` +
                       `I am currently out of the office.<br>` +
                       `I will have no access to my emails during this time.<br><br>` +
                       `I will review your message upon my return on <b>${en}</b>.<br><br>` +
                       `Best regards,`;

            } else if (currentScenario === 'rtt') { 
                subject = `[INFO] Absence / RTT (Retour : ${short})`;
                body = `Bonjour,<br><br>` +
                       `Je suis absent ce jour et n'ai pas accès à ma messagerie.<br>` +
                       `Je prendrai connaissance de votre message à mon retour, prévu le <b>${fr}</b>.<br><br>` +
                       `Pour tout incident technique, le réflexe reste d'ouvrir un ticket sur le portail <b>Freshservice</b>.<br><br>` +
                       `En cas d'urgence nécessitant une action immédiate sur l'un de nos systèmes ou sur un flux critique, je vous prie de contacter <b>${contactChris}</b>.<br><br>` +
                       `Cordialement,<br>` +
                       `${textSeparator}` +
                       `Hello,<br><br>` +
                       `I am currently out of the office today.<br>` +
                       `I will have no access to my emails.<br><br>` +
                       `I will review your message upon my return on <b>${en}</b>.<br><br>` +
                       `Best regards,`;

            } else if (currentScenario === 'deplacement') {
                subject = `[INFO] En déplacement / Business Trip (Retour : ${short})`;
                body = `Bonjour,<br><br>` +
                       `Je suis actuellement en déplacement professionnel.<br>` +
                       `Je reste joignable, mais ma consultation des emails sera très limitée jusqu'au <b>${fr}</b>.<br><br>` +
                       `Pour tout incident technique, merci d'ouvrir un ticket sur le portail <b>Freshservice</b>.<br><br>` +
                       `En cas d'urgence nécessitant une action immédiate, vous pouvez contacter <b>${contactChris}</b> ou me joindre sur mon mobile pour les sujets critiques.<br><br>` +
                       `Cordialement,<br>` +
                       `${textSeparator}` +
                       `Hello,<br><br>` +
                       `I am currently on a business trip.<br>` +
                       `I will have limited access to my emails until <b>${en}</b>.<br><br>` +
                       `I will get back to you as soon as possible upon my return.<br><br>` +
                       `Best regards,`;

            } else if (currentScenario === 'support_off') {
                subject = `[INFO] Service restreint / Limited Support (Retour : ${short})`;
                body = `Bonjour,<br><br>` +
                       `Je suis actuellement absent du bureau. Je prendrai connaissance de votre message à mon retour le <b>${fr}</b>.<br>` +
                       `Durant cette période, le support technique fonctionne en service restreint.<br><br>` +
                       `Merci de privilégier l'ouverture d'un ticket sur le portail <b>Freshservice</b> pour tout incident.<br><br>` +
                       `<b>Attention :</b> En l'absence de support technique disponible, pour toute <b>urgence critique ou blocage impératif</b>, merci de m'adresser une notification par <b>SMS</b> sur mon mobile professionnel.<br><br>` +
                       `Cordialement,<br>` +
                       `${textSeparator}` +
                       `Hello,<br><br>` +
                       `I am currently out of the office.<br>` +
                       `I will review your message upon my return on <b>${en}</b>.<br><br>` +
                       `Best regards,`;
            }

            body += signature;

            document.getElementById('preview-subject').textContent = subject;
            document.getElementById('preview-body').innerHTML = body;
        }

        // --- CORRECTION DU BUG DE COPIE ---
        function copySubject() {
            const text = document.getElementById('preview-subject').textContent.trim();
            const tempInput = document.createElement('textarea');
            tempInput.style.position = 'fixed';
            tempInput.style.left = '-9999px';
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
                document.execCommand('copy');
                showToast("Objet copié !");
            } catch (err) {
                console.error("Erreur copie objet:", err);
                alert("Erreur lors de la copie. Merci de copier le texte manuellement.");
            }
            document.body.removeChild(tempInput);
        }

        function copyBody() {
            const bodyHtml = document.getElementById('preview-body').innerHTML;
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'fixed'; tempDiv.style.left = '-9999px';
            // Forcer le style pour Gmail
            tempDiv.innerHTML = `<div style="font-family: Verdana, sans-serif; font-size: 13px; color: #222222; background-color: #ffffff; margin: 0; padding: 0;">${bodyHtml}</div>`;
            document.body.appendChild(tempDiv);
            const range = document.createRange();
            range.selectNode(tempDiv);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            try {
                document.execCommand('copy');
                showToast("Corps du message copié !");
            } catch (err) { alert("Erreur copie."); }
            window.getSelection().removeAllRanges();
            document.body.removeChild(tempDiv);
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').textContent = msg;
            toast.classList.remove('translate-y-24', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-24', 'opacity-0'), 3000);
        }

        setScenario('rtt'); 
    </script>
</body>
</html>
